(function(f,d,e){var k=function(){},g=d.Notifier=d.Model.extend({defaults:{baseCls:"notifier",types:["warning","error","info","success"],dialog:!1,theme:"plastic",message:"",closeBtn:!1,title:void 0,hideOnClick:!0,type:null,cls:null,ms:1E4,loader:!1,destroy:!1,modal:!1,opacity:1,offsetY:0,fadeInMs:500,fadeOutMs:500,position:"top",screenOpacity:0.65,zIndex:1E4,width:void 0,modules:void 0},transitions:{top:{"in":function(a,b,c,i,e){a.css({display:"block",top:-1E3});a.css({top:-b.innerHeight()}).animate({top:c.offsetY,
opacity:c.opacity},i,e||k)},out:function(a,b,c,i,e){a.animate({top:-b.innerHeight(),opacity:0},i,e||k)}},center:{"in":function(a,b,c,i,e){a.css({top:c.offsetY-40,display:"block"}).animate({top:"50%",marginTop:-b.innerHeight()/2,opacity:c.opacity},i,e||k)},out:function(a,b,c,i,e){a.animate({top:"0%",opacity:0},i,e||k)}},bottom:{"in":function(a,b,c,e,g){a.css({bottom:c.offsetY-40,top:"auto",display:"block"}).animate({bottom:b.innerHeight()+c.offsetY,opacity:c.opacity},e,g||k)},out:function(a,b,c,e,
g){a.animate({bottom:-b.height(),opacity:0},e,g||k)}}},template:function(a){var b=['<div class="'+a.wrapperCls+'">','<div class="'+a.innerCls+'">',a.title?'<div class="'+a.baseCls+'-title">'+a.title+"</div>":"",a.closeBtn?'<button class="'+a.baseCls+'-close" data-handler="destroy"><span>x</span></button>':""];a.dialog?b.push('<div class="'+a.baseCls+'-message">'+a.message+(a.loader?'<div class="'+a.baseCls+'-loader"></div>':"")+"</div>"):b.push('<div class="'+a.baseCls+'-message">'+a.message+"</div>",
a.loader?'<div class="'+a.baseCls+'-loader"></div>':"");if(a.buttons){var c=f("<div />");e.each(a.buttons,function(a){c.append(f("<button/>",a))});b.push('<div class="'+a.baseCls+'-btns">'+c.html()+"</div>")}b.push("</div></div>");return b.join("")},initEl:function(){var a=this.el?this.el:"body",a=e.isObject(a)?a:f(a);if(!a.length)return f(f.proxy(this.initEl,this));this.$el=a;this._cssPos=a.get(0)===document.body?"fixed":"absolute";a.get(0)!==document.body&&a.css("position","relative");"absolute"===
this._cssPos&&a.css("overflow","hidden")},initialize:function(a){var b=this;this.el=a&&a.el;this.initEl.call(this,a&&a.el);this.current={};b.NotificationView=d.View.extend({defaults:b.attributes,on:function(a,b){var c=b,i=this;e.isString(b)&&(c=function(){i[b].apply(i,arguments)});return d.View.prototype.on.call(this,a,c)}});var c=function(a){b[a]=b[a]||function(c){e.isString(c)&&(c={message:c});c=e.extend({},{type:""},c);c.type=c.type?a+" "+c.type:a;return b.notify(c)}};e.each(b.attributes.types,
function(a){c(a)});if(b.attributes){var i=this.attributes.modules;i&&f.each(i,function(a,b){b.name=e.isArray(i)?b.name:a;g.regModule(b)});b.attributes.modules=void 0}},calcZIndex:function(){if("absolute"===this._cssPos)return this.attributes.zIndex;var a=this.attributes.zIndex+1;e.each(this.current,function(b){a=b.zIndex>a?b.zIndex:a});return++a},destroyAll:function(a,b){var c=0;e.isFunction(a)?e.each(this.current,function(b){a(b)&&(b.destroy.call(b),c++)}):void 0!==a?e.each(this.current,function(e){e.settings[a]===
b&&(e.destroy.call(e),c++)}):e.each(this.current,function(a){a.destroy.call(a);c++});return c},getWrapperCls:function(a){return f.trim(a.baseCls+" "+(a.type?a.type+" ":"")+("theme-"+a.theme+" ")+(a.dialog?"dialog ":"")+("pos-"+a.position+" ")+(a.buttons?"with-buttons ":"")+(a.loader?"with-loader ":"")+(a.closeBtn?"with-close-btn ":"")).split(" ").join(" "+a.baseCls+"-")+" "+(a.cls||"")},getSettings:function(a){e.isString(a)&&(a={message:a});var b=f.extend({},this.attributes,a);b.title&&void 0===a.dialog&&
(b.dialog=!0);if((b.modal||b.dialog)&&void 0===a.hideOnClick)b.hideOnClick=!1;b.dialog&&void 0===a.ms&&(b.ms=null);b.dialog&&void 0===a.position&&(b.position="center");return b},notify:function(a){a=a||{};a.el&&(this.el=a&&a.el,this.initEl.call(this,a&&a.el));var b=this,c=this.getSettings(a);e.isObject(c.destroy)?c.destroy instanceof b.NotificationView?c.destroy.destroy():b.destroyAll.apply(b,e.isArray(c.destroy)?c.destroy:[c.destroy]):!0===c.destroy&&b.destroyAll();a=a.zIndex||b.calcZIndex.call(b);
c.wrapperCls=b.getWrapperCls(c);c.innerCls=c.baseCls+"-inner";var i=f(b.template(c)),d=i.find("."+c.innerCls);c.width&&d.css({width:c.width});g._modulesBinder.trigger("beforeAppendMsgEl",b,c,i,d);i.css({display:"none",opacity:0,position:b._cssPos,zIndex:c.modal?++a:a}).prependTo(b.$el);var h=new b.NotificationView({el:i});h.settings=c;if(c.buttons||d.find("button").length)d.on("click","button[data-handler]",function(){var a=f(this).data("handler");(e.isFunction(a)?a:h[a]).apply(h,arguments)}),d.on("button click",
function(a){h.trigger("click:"+f(a.target).data("role"))});var k=h.destroy=function(a){if(e.isObject(a)&&a.preventDefault){a.preventDefault();a.stopPropagation()}h.trigger("beforeHide",h,i);c.modal&&h.screenEl.fadeOut(300,function(){h.trigger("screenHide",h,i);h.screenEl.remove()});g._modulesBinder.trigger("beforeHideMsgEl",b,c,i,d,h);(f.isFunction(c.out)?c.out:b.transitions[c.position].out).call(b,i,d,c,c.fadeOutMs,function(){h.remove();h.trigger("destroy",h,i);g._modulesBinder.trigger("afterDestroyMsgEl",
b,c,i,d,h);e.isFunction(a)&&a.call(h,h,i)});h.timeoutId&&clearTimeout(h.timeoutId);delete h.timeoutId;delete b.current[h.cid]},j=function(a){if(a){a.preventDefault();a.stopPropagation()}};c.modal&&(h.screenEl=f("<div/>",{"class":c.baseCls+"-screen "+c.baseCls+"-theme-"+c.theme,css:{position:b._cssPos,top:0,left:0,width:"100%",height:"100%",opacity:0,zIndex:a-1}}).prependTo(b.$el).click(function(a){a.preventDefault();a.stopPropagation();return false}).fadeTo(300,c.screenOpacity));if(0<c.ms||0===c.ms)h.timeoutId=
setTimeout(function(){h.trigger("timeout",h,i);k()},c.ms);d.click(c.hideOnClick?k:j);c.css&&d.css(c.css);j=f.isFunction(c["in"])?c["in"]:b.transitions[c.position]["in"];b.current[h.cid]=h;h.zIndex=a;g._modulesBinder.trigger("beforeAnimateInMsgEl",b,c,i,d,h);j.call(b,i,d,c,c.fadeInMs,function(){g._modulesBinder.trigger("afterAnimateInMsgEl",b,c,i,d,h)});return h}});g.getModule=function(a){return e.isObject(a)?a:g.modules[a]};var j={},l=Array.prototype.shift;e.extend(j,d.Events);g._modulesBinder=j;
g.regModule=function(a,b){1===arguments.length?(b=f.isFunction(a)?a():a,a=b.name):(b=f.isFunction(b)?b():b,b.name=a);if(!a)throw"module name is not defined.";b.extend&&f.each(b.extend,function(a,d){var k=g.prototype[a];g.prototype[a]=e.isFunction(d)||k===void 0?function(){return d.apply({scope:this,supr:k,module:b},arguments)}:e.isObject(d)?f.extend(true,{},k,d):d});(g.modules=g.modules||{})[a]=b;f.isFunction(b.register)&&b.register.call(b,g);b.enabled&&g.enableModule(b);return b};g.enableModule=
function(a){var b=g.getModule(a);return b?(b._handlers=b._handlers||{},b.events&&f.each(b.events,function(a,e){var d=b._handlers[a]=function(){var a=l.call(arguments);e.apply({module:b,scope:a},arguments)};g._modulesBinder.on(a,d)}),b.enabled=!0,f.isFunction(b.enable)&&b.enable.call(b,g),b):!1};g.disableModule=function(a){return(a=g.getModule(a))?(f.each(a._handlers,function(a,c){g._modulesBinder.off(a,c)}),a.enabled=!1,f.isFunction(a.disable)&&a.disable.call(a,g),a):!1}})(jQuery,Backbone,_);
(function(f,d,e){f.regModule({name:"template",enabled:!0,extend:{template:function(d){if(d.data){var g=e.template(d.message);d.message=g(d.data)}return this.supr.call(this.scope,d)}}})})(Backbone.Notifier,jQuery,_);
(function(f,d){f.regModule({name:"3d",enabled:!1,extend:{defaults:{"3d":!0}},events:{beforeAnimateInMsgEl:function(e,f,g,j){if(e["3d"]){var l=this.module,e=j.handle3d=function(){l.mouseMoveHandler.apply(l,arguments)};d("body").bind("mousemove",{msgInner:g},e)}},beforeHideMsgEl:function(e,f,g,j){e["3d"]&&d("body").unbind("mousemove",j.handle3d)}},mouseMoveHandler:function(e){var f=d(window).innerHeight(),g=d(window).innerWidth(),j=2*(0.5-e.clientX/g),g=-(10*j).toFixed(2),l=2*(0.5-e.clientY/f),f=(20*
l).toFixed(2),a=10*j,b=10*l,c=Math.abs(a)+Math.abs(b),j=0.8-0.4*((Math.abs(j)+Math.abs(l))/2),j=a.toFixed(2)+"px "+b.toFixed(2)+"px "+c.toFixed(2)+"px rgba(0,0,0,"+j.toFixed(2)+")",a={};a[this.transformAttr]="perspective(800px) rotateX("+f+"deg) rotateY("+g+"deg)";a[this.shadowAttr]=j;e.data.msgInner.css(a)},getVendorPrefix:function(e){for(var f=d.map(["","-webkit-","-moz-","-ms-","-o-"],function(a){return a+e}),g=document.createElement("div"),j=e,l=0;l<f.length;++l)if("undefined"!==typeof g.style[f[l]]){j=
f[l];break}return j},register:function(){this.transformAttr=this.getVendorPrefix("transform");this.shadowAttr=this.getVendorPrefix("box-shadow")},enable:function(){},disable:function(){}})})(Backbone.Notifier,jQuery);
(function(f){f.regModule({name:"logger",enabled:!0,extend:{defaults:{showInLog:!0},initialize:function(){this.scope._loggerNotifierId=++this.module._notifiers;this.module.doStringify=!!~window.navigator.userAgent.indexOf("msie");this.module._log("initializing notifier #"+this.scope._loggerNotifierId);return this.supr.apply(this.scope,arguments)}},events:{beforeAppendMsgEl:function(d){d._loggerNotificationId=++this.module._notifications;d.showInLog&&this.module._log("beforeAppendMsgEl #"+d._loggerNotificationId,
d)},beforeAnimateInMsgEl:function(d){d.showInLog&&this.module._log("beforeAnimateInMsgEl #"+d._loggerNotificationId)},afterAnimateInMsgEl:function(d){d.showInLog&&this.module._log("afterAnimateInMsgEl #"+d._loggerNotificationId)},beforeHideMsgEl:function(d){d.showInLog&&this.module._log("beforeHideMsgEl #"+d._loggerNotificationId)},afterDestroyMsgEl:function(d){d.showInLog&&this.module._log("afterDestroyMsgEl #"+d._loggerNotificationId)}},_log:function(d,e){window.console&&window.console.log&&(d=
"logger: "+d,2<=arguments.length?(e=_.isString(e)?e:this.doStringify?" "+JSON.stringify(e):e,console.log(d,e)):console.log(d))},register:function(){this._notifiers=this._notifications=0;this._log(this.name+" module was registered")},enable:function(){this._log(this.name+" module was enabled")},disable:function(){this._log(this.name+" module was disabled")}})})(Backbone.Notifier,jQuery);
